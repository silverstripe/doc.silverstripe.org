
# [MANUAL_PHASE]: Handle next-env.d.ts File (Human Action Required)

**Objective:** Prevent `next-env.d.ts` from causing unwanted git changes.

**This phase requires HUMAN action only - no code changes by AI:**

1. **Human should decide:** The `next-env.d.ts` file is auto-generated by Next.js and references build-time type routes. Options:
   - **Option A (Recommended):** Delete the file and add it to `.gitignore`
     - Run: `rm next-env.d.ts`
     - Add `next-env.d.ts` to `.gitignore`
     - Run: `git add .gitignore && git commit -m "Ignore next-env.d.ts"`
   - **Option B:** Keep the file committed but accept it will change with builds

2. **Human Action Required:**
   - If choosing Option A: Delete `next-env.d.ts`, update `.gitignore`, and commit both changes.
   - No AI tasks for this phase.

---

# Phase 1: Fix Sidebar Scroll Independence

**Objective:** Prevent main content scroll from affecting the sidebar navigation; sidebar should scroll independently.

**Tasks:**
1. Update `src/components/DocsLayout.module.css`
   - Add `overscroll-behavior: contain` to `.sidebarContainer` to prevent scroll chaining from content to sidebar.
   - Ensure sidebar scrolls independently when cursor is over it.
2. Create UNIT TEST `tests/components/SidebarScroll.test.tsx`
   - Verify the sidebarContainer has `overscroll-behavior: contain` style applied.
   - Verify the sidebar has `overflow-y: auto` for independent scrolling.
3. Run tests
   - Command: `npm test -- --testPathPattern="SidebarScroll"`

---

# Phase 2: Fix Logo Link to Respect Current Version

**Objective:** Logo click navigates to `/en/{currentVersion}/` instead of always `/en/6/`.

**Tasks:**
1. Update `src/components/Header.tsx`
   - Change the logo `<Link href="/">` to use `/en/${version}/` where `version` is extracted from current pathname.
   - Ensure fallback to default version if version cannot be determined.
2. Create UNIT TEST `tests/components/HeaderLogo.test.tsx`
   - Test logo href is `/en/3/` when on a v3 page.
   - Test logo href is `/en/6/` when on a v6 page.
   - Test logo href uses default version when version cannot be determined.
3. Run tests
   - Command: `npm test -- --testPathPattern="HeaderLogo"`

---

# Phase 3: Fix Dark Mode Table Striping Contrast

**Objective:** Reduce zebra-stripe contrast on tables in dark mode.

**Tasks:**
1. Update `src/app/globals.css`
   - Add dark mode styles for `table tbody tr:nth-child(odd)` with reduced contrast background.
   - Use a subtle dark background like `rgba(255, 255, 255, 0.03)` instead of `#f5f5f5`.
2. Create UNIT TEST `tests/styles/DarkModeTable.test.ts`
   - Parse globals.css and verify dark mode rule exists for table striping.
   - Verify the dark mode rule uses appropriate low-contrast background value.
3. Run tests
   - Command: `npm test -- --testPathPattern="DarkModeTable"`

---

# Phase 4: Consolidate copy-images Script into Build Process

**Objective:** Remove standalone `copy-images` commands by integrating image copying into dev/build scripts.

**Tasks:**
1. Review `scripts/copy-images.mjs` to understand its purpose
   - It copies images from `.cache/{context}/` to `public/` and `out/` directories.
   - Already called in `build:docs`, `build:user`, and `mock` scripts.
2. Update `package.json`
   - Add image copying to `dev:docs` and `dev:user` scripts (run once before dev server starts).
   - Pattern: `"dev:docs": "DOCS_CONTEXT=docs npm run copy-images:docs && next dev --port 9876"`
   - Pattern: `"dev:user": "DOCS_CONTEXT=user npm run copy-images:user && next dev --port 9876"`
   - Keep individual `copy-images:*` scripts for manual use but document in AGENTS.md.
3. Update `AGENTS.md`
   - Remove standalone `copy-images` commands from primary commands list.
   - Note that image copying is now automatic during dev and build.
4. Create UNIT TEST `tests/build/DevScripts.test.ts`
   - Verify `dev:docs` includes `copy-images:docs`.
   - Verify `dev:user` includes `copy-images:user`.
5. Run tests
   - Command: `npm test -- --testPathPattern="DevScripts"`

---

# Phase 5: Fix build:user Building Docs Site Instead of User Site

**Objective:** `npm run build:user` should build the user site, not the docs site.

**Tasks:**
1. Update `package.json`
   - Fix `build:user` script to properly pass `DOCS_CONTEXT=user` to `next build`.
   - Change from chained commands to ensure environment variable persists through entire build.
   - Pattern: `"build:user": "DOCS_CONTEXT=user sh -c 'npm run clone:user && next build && npm run copy-images:user'"`
2. Create UNIT TEST `tests/build/BuildScripts.test.ts`
   - Parse `package.json` and verify `build:user` script contains `DOCS_CONTEXT=user` for the `next build` step.
   - Verify `build:docs` script contains `DOCS_CONTEXT=docs` for the `next build` step.
3. Run tests
   - Command: `npm test -- --testPathPattern="BuildScripts"`

---
